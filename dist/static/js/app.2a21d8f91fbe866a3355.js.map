{"version":3,"sources":["webpack:///./src/index.js","webpack:///./src/niepan.js","webpack:///./src/index.np"],"names":["content","__webpack_require__","console","log","niepan","o","sub","pub","request","url","success","res","li1","document","getElementById","body","li3","$data","age","input1","evt","name","__WEBPACK_AMD_DEFINE_RESULT__","global","undefined","copyright","np","element","prototype","create","version","ast","_index","_res","index","childElementCount","children","childNodes","child","this","push","nodeName","parent","parentIndex","nodeType","append","elementOrString","parentNode","Error","appendChild","innerHTML","$np","init","$element","$originals","$listeners","$watch","getAttribute","Object","defineProperty","set","v","value","bind","get","$status","$set","k","$get","event","callback","once","system","Symbol","systemSymbol","systemCallback","removeEventListener","addEventListener","warn","method","xhr","fail","XMLHttpRequest","window","ActiveXObject","onreadystatechange","readyState","status","response","open","headers","toString","call","forEach","setRequestHeader","send","animate","fn","time","obeserve","MutationObserver","WebKitMutationObserver","MozMutationObserver","mutations","nodes","addedNodes","i","length","node","notxss","blacks","indexOf","src","removeChild","e","observe","subtree","childList","keywords","withelist","module","exports","apply"],"mappings":"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","file":"static/js/app.2a21d8f91fbe866a3355.js","sourcesContent":["//np-loader会\nvar content = require('./index.np');\nconsole.log(content);\nconst niepan = require('./niepan.js');\nconsole.log(niepan);\nvar o = niepan();\nconsole.log(o);\n\no.sub('xx',function(){console.log('pub...')});\no.pub('xx');\no.pub('xx');\n\no.sub('yy',function(){console.log('pub...')},true);\no.pub('yy');\no.pub('yy');\n\no.request({\n  url:'http://localhost:8888',\n  success:function(res){\n    console.log(res);\n  }\n});\n\nvar li1 = niepan(document.getElementById('li1'));\nconsole.log(li1);\nli1.sub('click',function(){\n  console.log('clicked li1,this event could be pubed all the time');\n});\n\nvar body= niepan(document.body);\nconsole.log(body);\nbody.sub('click',function(){\n  console.log('clicked body,this event would be pubed only one time');\n},true);\n\nvar li3 = niepan(document.getElementById('li3'));\nconsole.log(li3.$data.age);\n\nvar input1 = niepan(document.getElementById('input1'));\ninput1.sub('input',function(evt){\n  console.log(input1.$data.name);\n});\n\n// It will throw a error when define a niepan for the same element moe than one time;\n// var input2 = niepan(document.getElementById('input1'));//ERROR\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","(function(global, undefined) {\n\n  //防止重复加载niepan.js\n  if (global.niepan && global.niepan.copyright === '@yegao') {\n    return;\n  }\n\n  //达到np()等价于new np()的目的\n  var np = function(element = null) {\n    return np.prototype.create(np.prototype, element);\n  }\n\n  //原型属性\n  np.prototype = {\n    //内部静态变量,最好不要动\n    version: '1.0.7',\n    copyright: '@yegao',\n    /**\n     * @todo 抽象语法树\n     * @param  {[type]} element [description]\n     * @param  {[type]} _index  [description]\n     * @param  {[type]} _res    [description]\n     * @return {[type]}         [description]\n     */\n    ast: function(element, _index, _res) {\n      // if(Object.prototype.toString.call(element) === \"[object Array]\"){\n      //   console.warn('the ast get multiple trees');\n      //   return ;\n      // }\n      if (!element) {\n        return;\n      }\n      /********************************************************************************************\n       *     ·[3]                                                                                 *\n       *     ·[2]            ·[2]                            ·[4]                                 *\n       *     ·[3]            ·[3]            ·[3]            ·[2]        ·[2]        ·[0]    ·[1] *\n       *     ·[0]·[0]·[0]    ·[0]·[0]·[0]    ·[0]·[0]·[0]    ·[0]·[0]    ·[0]·[0]            ·[0] *\n       ********************************************************************************************/\n      var index = _index || 0;\n      var res = _res || [];\n      //nodeType 1的比如img的childElementCount为0 nodeType为3的txt没有childElementCount\n      if (element.childElementCount) {\n        var children = element.childNodes;\n        for (var index of children) {\n          var child = children[index];\n          child.index = element.index + '|' + index;\n          return this.ast(child, res);\n        }\n      }\n      res.push({\n        nodeName: element.nodeName,\n        childNodes: element.childNodes,\n        parent: parentIndex || 0,\n        nodeType: element.nodeType\n      });\n      return res;\n    },\n    /**\n     * @todo需不需要将插入的子节点转成niepan,或者是添加一个参数来控制?\n     * @param  {[object|string]} elementOrString [description]\n     * @param  {[object]} parentNode      [description]\n     * @return {[object]}                 [description]\n     */\n    append: function(elementOrString, parentNode) {\n      if (!parentNode || typeof parentNode != 'object') {\n        throw new Error('you append a element to a undefined parent node');\n      }\n      switch (typeof elementOrString) {\n        case 'object':\n          return parentNode.appendChild(elementOrString);\n        case 'string':\n          parentNode.innerHTML += elementOrString;\n          return ast(elementOrString)\n        default:\n          throw new Error('you append a element to a undefined parent node');\n      }\n    },\n    /**\n     * 以prototype为原型创建一个对象，该对象的element属性为element\n     * @todo 是否需要合并重复的niepan,脏检查或者直接将元素上的事件就直接放到元素上，仔细一想也没什么必要...待定\n     * @param  {object} prototype 原型\n     * @param  {object} element   niepan对绑定的元素\n     * @return {object}           生成的niepan\n     */\n    create: function(prototype, element) {\n      if (element) {\n        if (element.$np) {\n          throw new Error('this element has been a niepan');\n        }\n        element.$np = true;\n      }\n      // 实例属性都有一个$符号,和原型属性作区分\n      var init = function() {\n        //传参里的element的优先级最高，如果没有传element就检查有没有定义template函数\n        this.$element = element;\n        //当前实例绑定的变量全部放在$data中\n        this.$data = {};\n        //元素原本就有的事件监听类型\n        this.$originals = [];\n        //listeners = originals + unoriginals\n        this.$listeners = [];\n        //watch 实现双向绑定\n        this.$watch = element && element.getAttribute('watch');\n        if (this.$watch) {\n          if (typeof this.$watch != 'string') {\n            throw new Error('the attribute \"watch\" should be a string!');\n          }\n          // 发现不能重写element.__proto__.value的setter方法（native code）\n          // console.log(Object.getOwnPropertyDescriptor(this.$element.constructor.prototype,'value').set);\n          // Object.getOwnPropertyDescriptor(this.$element.constructor.prototype,'value').set = function(){\n          //   console.log('xxx');\n          // }\n          Object.defineProperty(this.$data, this.$watch, {\n            set: (function(v) {\n              this.$element.value = v;\n            }).bind(this),\n            get: (function() {\n              return this.$element.value;\n            }).bind(this)\n          })\n        }\n        //状态\n        this.$status = {};\n        this.$set = function(k, v) {\n          this.$status[k] = v;\n          return this.$status;\n        };\n        this.$get = function(k) {\n          return this.$status[k];\n        }\n      };\n      // 原型属性\n      init.prototype = prototype;\n      return new init;\n    },\n    /**\n    * 通过sub注册的事件如果是元素自带的系统事件，既可以通过pub触发也可以通过系统方式(比如点击鼠标)触发\n    * 通过sub注册的事件如果是自定义的事件，只能通过pub触发\n    * @param  {[type]}   event    事件名\n    * @param  {Function} callback 事件被触发后执行的回调方法\n    * @param  {[type]}   once     该事件被触发一次之后是否被销毁\n    */\n    sub: function(event, callback, once) {\n      // console.log(this.$element, event);\n      if (typeof callback === 'function') {\n        //自定义事件\n        this.$listeners[event] = {\n          callback: callback, //事件回调方法\n          once: once, //是否只能被触发一次\n          system: this.$element && ('on' + event in this.$element) && Symbol(event) //是否是元素自带的系统事件,是则返回一个Symbol\n        }\n        //系统事件\n        var systemSymbol = this.$listeners[event].system;\n        if (systemSymbol) {\n          var systemCallback = this.$originals[systemSymbol] = (function(evt) {\n            // console.log(this, evt);\n            if (this.$listeners[event].once) {\n              delete this.$originals[systemSymbol];\n              this.$element.removeEventListener(event, systemCallback);\n            }\n            this.pub(event);\n          }).bind(this);\n          this.$element.addEventListener(event, systemCallback);\n        }\n      }\n    },\n    /**\n     * 触发事件\n     * @param  {string} event 事件名\n     */\n    pub: function(event) {\n      if (this.$listeners[event]) {\n        this.$listeners[event].callback();\n        if (this.$listeners[event].once) {\n          console.log('delete');\n          delete this.$listeners[event];\n        }\n      } else {\n        console.warn('not found event \\'' + event + '\\',maybe it has been removed');\n      }\n    },\n    /**\n     * 绑定事件,该事件只能被触发一次就会被销毁\n     * @param  {object}   event    [description]\n     * @param  {Function} callback [description]\n     */\n    once: function(event, callback) {\n      this.sub(event, callback, true);\n    },\n    /**\n     * 发送http请求\n     * @param  {object} o [description]\n     */\n    request: function(o) {\n      if (!o.url) {\n        throw new Error('niepan.request need url!');\n      }\n      var url = o.url,\n        method = o.method || 'GET',\n        success = o.success || function() {},\n        fail = o.fail || function() {};\n      var xhr = null;\n      if (global.XMLHttpRequest) {\n        xhr = new XMLHttpRequest();\n      } else if (window.ActiveXObject) { // for IE5 and IE6\n        xhr = new ActiveXObject(\"Microsoft.XMLHTTP\");\n      }\n      if (xhr) {\n        xhr.onreadystatechange = function() {\n          if (xhr.readyState == 4) { // XMLHttpRequest.DONE\n            if (xhr.status == 200) { // 200 = \"服务端成功处理\"\n              success(xhr.response);\n            } else {\n              throw new Error(\"\");\n            }\n          }\n        };\n        xhr.open(method, url, true);\n        if (o.headers && Object.prototype.toString.call(o.headers) === \"[object Array]\") {\n          // headers = o.headers || [{\n          //   'Content-Type': 'application/x-www-form-urlencoded'\n          // }];\n          headers.forEach(function(v, k) {\n            xhr.setRequestHeader(k, v);\n          });\n        }\n        xhr.send(null);\n      } else {\n        throw new Error(\"current environment does not support XMLHTTP!\");\n      }\n    },\n    /**\n     * 动画\n     * @param  {Function} fn   [description]\n     * @param  {number}   time [description]\n     */\n    animate: function(fn, time) {\n      function step() {\n        if (typeof fn === 'function') {\n          fn();\n        }\n        if (global.requestAnimationFrame) {\n          global.requestAnimationFrameraf(step);\n        } else {\n          setTimeout(step, time)\n        }\n      }\n    },\n    // 文件上传\n    // file:function(resource,callback){\n    //   if(callback){\n    //     callback();\n    //   }\n    //   return {\n    //     progress:0,\n    //     url:''\n    //   }\n    // },\n    /**\n     * MutationObserver 的不同兼容性写法\n     * 该构造函数用来实例化一个新的 Mutation 观察者对象\n     * Mutation 观察者对象能监听在某个范围内的 DOM 树变化\n     * @type {[type]}\n     */\n    obeserve: function() {\n      var MutationObserver = global.MutationObserver || global.WebKitMutationObserver || global.MozMutationObserver;\n      var observer = new MutationObserver(function(mutations) {\n        mutations.forEach(function(v) {\n          var nodes = v.addedNodes;\n          for (var i = 0; i < nodes.length; i++) {\n            var node = nodes[i];\n            if (this.notxss.blacks.indexOf(node.src) != -1) {\n              try {\n                node.parentNode.removeChild(node);\n                console.log('拦截可疑静态脚本:', node.src);\n              } catch (e) {\n                console.warn(e);\n              }\n            }\n          }\n        });\n      });\n      // 传入目标节点和观察选项\n      // 如果 target 为 document 或者 document.documentElement\n      // 则当前文档中所有的节点添加与删除操作都会被观察到\n      observer.observe(document, {\n        subtree: true,\n        childList: true\n      });\n    },\n    /**\n     * 防止xss攻击\n     * @type {Object}\n     */\n    notxss: {\n      keywords: [], //检测的关键字符\n      withelist: [], //白名单列表\n      blacks: [], //黑名单列表\n    }\n  }\n  // Commonjs\n  if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = np\n  } else {\n    throw new Error('current environment do not support niepan');\n  }\n  //global、amd、cmd、\n  if (global) {\n    global.niepan = np;\n  } else if (typeof define === 'function') {\n    if (define.amd) {\n      define('niepan', [], function() {\n        return np;\n      })\n    } else if (define.cmd) {\n      define(function(require, exports, module) {\n        module.exports = np;\n      })\n    }\n  }\n})(window || this);\n\n\n\n// WEBPACK FOOTER //\n// ./src/niepan.js","module.exports = \"<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n  <meta charset=\\\"UTF-8\\\">\\n  <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\">\\n  <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"ie=edge\\\">\\n  <title>niepan example</title>\\n</head>\\n<body>\\n  <ul id=\\\"ul\\\">\\n    <li id=\\\"li1\\\">1</li>\\n    <li id=\\\"li2\\\">2</li>\\n    <li id=\\\"li3\\\" watch=\\\"age\\\">3</li>\\n  </ul>\\n  <div>-------------</div>\\n  <input np id=\\\"input1\\\" type=\\\"text\\\" value=\\\"\\\" watch=\\\"name\\\" placeholder=\\\"place input your name\\\" />\\n  <div></div>\\n</body>\\n</html>\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/index.np\n// module id = z3By\n// module chunks = 0"],"sourceRoot":""}